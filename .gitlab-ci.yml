image: eicweb.phy.anl.gov:4567/eic/juggler/juggler:latest

nevents:
  stage: test
  tags:
    - s3
  artifacts:
    expire_in: 1 week 
    paths:
      - results/
  parallel:
    matrix:
      - DATA: ["DVCS.csv", "DIS.csv", "SIDIS.csv", "SINGLE.csv"]
  script:
    - mc config host add S3 https://dtn01.sdcc.bnl.gov:9000 ${S3_ACCESS_KEY} ${S3_SECRET_KEY}
    - mkdir -p results/datasets/nevents/
    - cat $DATA | parallel -j 8 --colsep "," scripts/count_events.sh {1} {2} | tee results/datasets/nevents/$DATA

timing:
  stage: test
  tags:
    - s3
  needs: ["nevents"]
  artifacts:
    expire_in: 1 week 
    paths:
      - results/
  parallel:
    matrix:
      - DATA: ["DVCS.csv", "DIS.csv", "SIDIS.csv", "SINGLE.csv"]
  script:
    - mc config host add S3 https://dtn01.sdcc.bnl.gov:9000 ${S3_ACCESS_KEY} ${S3_SECRET_KEY}
    - mkdir -p results/datasets/timings/
    - cat results/datasets/nevents/$DATA | parallel -j 8 --colsep "," scripts/determine_timing.sh {1} {2} | tee results/datasets/timings/$DATA
