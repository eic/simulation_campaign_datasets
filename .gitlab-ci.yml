image: eicweb.phy.anl.gov:4567/eic/juggler/juggler:latest

DIS:
  stage: test
  tags:
    - s3
  script:
    - mc config host add S3 https://dtn01.sdcc.bnl.gov:9000 ${S3_ACCESS_KEY} ${S3_SECRET_KEY}
    - grep -v ^\#  DVCS.csv | awk -F',' '{print($1)}' | while read data ; do
        mkdir -p $(dirname ${data/EVGEN/EVGEN\/CI}) ;
        mc head -n 1000 S3/eictest/ATHENA/$data > ${data/EVGEN/EVGEN\/CI} ;
        nevents=$(grep ^E ${data/EVGEN/EVGEN\/CI} | wc -l) ;
        test $nevents -gt 0 ;
        /opt/campaigns/hepmc3/scripts/run.sh ${data/EVGEN/EVGEN\/CI} $((nevents-1)) ;
      done
